<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Task App - Debug Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "firebase/app": "https://esm.sh/firebase@10.7.1/app",
        "firebase/auth": "https://esm.sh/firebase@10.7.1/auth",
        "firebase/firestore": "https://esm.sh/firebase@10.7.1/firestore",
        "lucide-react": "https://esm.sh/lucide-react@0.303.0"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body { background-color: #f8fafc; font-family: sans-serif; }
        #error-log { 
            display: none; 
            background: #fee2e2; 
            color: #991b1b; 
            padding: 20px; 
            margin: 20px; 
            border: 2px solid #ef4444; 
            border-radius: 8px;
            direction: ltr; 
            white-space: pre-wrap;
        }
        #root:empty::before {
            content: 'טוען... (אם נתקע, המתן להודעת שגיאה)';
            display: block; text-align: center; margin-top: 50px; font-size: 24px; color: #64748b;
        }
    </style>
</head>
<body>
    <div id="error-log"></div>
    <div id="root"></div>

    <script>
        // Global Error Handler - catches crashes
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            const log = document.getElementById('error-log');
            log.style.display = 'block';
            log.innerHTML += `<h3>❌ CRITICAL ERROR:</h3><p>${msg}</p><p>Line: ${lineNo}</p><hr>`;
            return false;
        };
        const originalConsoleError = console.error;
        console.error = function(...args) {
            const log = document.getElementById('error-log');
            log.style.display = 'block';
            log.innerHTML += `<h3>⚠️ CONSOLE ERROR:</h3><p>${args.join(' ')}</p><hr>`;
            originalConsoleError.apply(console, args);
        };
    </script>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { initializeApp } from 'firebase/app';
        import { getAuth, signInAnonymously, onAuthStateChanged } from 'firebase/auth';
        import { getFirestore, doc, setDoc } from 'firebase/firestore';
        
        // --- YOUR KEYS ---
        const firebaseConfig = {
            apiKey: "AIzaSyCET42vMcj1uC0nMsqsWy2xd-yv1WC7e68",
            authDomain: "family-tasks-ee68f.firebaseapp.com",
            projectId: "family-tasks-ee68f",
            storageBucket: "family-tasks-ee68f.firebasestorage.app",
            messagingSenderId: "579816138584",
            appId: "1:579816138584:web:1b2a3cbf4c5fd00a45e72d"
        };

        // --- SAFE INITIALIZATION ---
        let app, auth, db;
        try {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);
        } catch (e) {
            throw new Error("Firebase Init Failed: " + e.message);
        }
        
        const appId = 'family-app-main'; 

        // Simplified App for Testing Connection
        function App() {
            const [status, setStatus] = useState('Initializing...');
            const [user, setUser] = useState(null);

            useEffect(() => {
                setStatus('Attempting to connect to Firebase Auth...');
                signInAnonymously(auth)
                    .then(() => setStatus('Signed in! Connecting to Database...'))
                    .catch((err) => {
                        console.error("Auth Error:", err.message);
                        setStatus('Auth Failed: ' + err.message);
                    });

                const unsubscribe = onAuthStateChanged(auth, (u) => {
                    if (u) {
                        setUser(u);
                        // Try to write to DB to test connection
                        const docRef = doc(db, 'artifacts', appId, 'public', 'test_connection');
                        setDoc(docRef, { connected: true, time: Date.now() })
                            .then(() => setStatus('SUCCESS! Database Connected.'))
                            .catch(e => {
                                console.error("Database Error:", e.message);
                                setStatus('Database Error: ' + e.message); 
                            });
                    }
                });
                return () => unsubscribe();
            }, []);

            return (
                <div className="p-10 text-center">
                    <h1 className="text-3xl font-bold mb-4">System Check</h1>
                    <div className={`p-4 rounded text-white font-bold text-xl ${status.includes('SUCCESS') ? 'bg-green-500' : 'bg-blue-500'}`}>
                        {status}
                    </div>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
